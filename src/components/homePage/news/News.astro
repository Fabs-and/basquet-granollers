---

import NewsDesktop from "@components/homePage/news/NewsDesktop.svelte";
import HomePageSectionLayout from "@layouts/HomePageSectionLayout.astro";
import Slider from "@components/Slider.svelte";
import { fetchPostsInCategory } from "fetch-wordpress-api";
import { isLastYearNews } from "@utils/helperFunctions";


const title = "CBG Notícies";

//Id needs to be included as a field it is used in newsDesktop to render in each block in svelte and also to compare with feature news

const [news, featuredNews] = await Promise.all([
  fetchPostsInCategory(19, ['title', 'image', 'slug', 'date', 'id']),
  fetchPostsInCategory(41, ['title', 'image', 'slug', 'date', 'id'])
]);

const lastYearNews = news.filter((oneNews) => isLastYearNews(oneNews.date));


let newsForSlider = lastYearNews;

if (featuredNews.length > 0) {
  newsForSlider = [featuredNews[0], ...lastYearNews];
}

export { featuredNews };
---

<HomePageSectionLayout
  sectionTitle="Notícies CBG"
  textColor={`var(--clr-primary)`}
  backgroundColor={`var(--clr-contrast)`}
>
  <div class="news-desktop">
    <NewsDesktop
      client:visible
      featuredNews={featuredNews[0] ? featuredNews[0] : lastYearNews[0]}
      news={lastYearNews}
    />
  </div>

  <div class="g-slider-container">
    <Slider
      client:visible
      sliderItems={newsForSlider}
      childComponent="NewsItem"
      itemWidth={312}
      gap={`1rem`}
    />
  </div>
</HomePageSectionLayout>

<style>
  .g-slider-container {
    display: none;
  }

  @media (width < 1068px) {
    .news-desktop {
      display: none;
    }
    .g-slider-container {
      display: block;
    }
  }

  @media (width < 1025px) {
    .g-slider-container {
      padding-bottom: var(--padding-section-medium);
    }
  }

  @media (width < 648px) {
    .g-slider-container {
      padding-bottom: var(--padding-section-small);
    }
  }
</style>
