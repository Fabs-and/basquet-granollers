---
// Import utils
import { fetchPages } from "@utils/apiFunctions/index";

// Import types
import type { Page } from "@utils/apiFunctions/types";

import PageLayout from "@layouts/PageLayout.astro";

// const { pages} = Astro.params;

// const pagesFromWP = await fetchPages(100, ['title', 'content', 'image', 'date', 'slug']);

//To generate pages in SSR
// const page = pagesFromWP.find((page) => page.slug === pages);

// if (!page) return Astro.redirect("/404");

// const { title, content, id, date, image } = page;

//WAITING for the migration to be done
export async function getStaticPaths() {
  const configPages = new Set(["capcalera", "peu-de-pagina", "la-familia-cbg", "equips", "patrocinadors-principals-logos-blaus", "patrocinadors-principals-logos-blancs", "altres-patrocinadors", "xarxes-socials", "jugadors-equip-senior-masculi", "jugadores-equip-senior-femeni" ]);
  const pages = await fetchPages(100, [
    "title",
    "content",
    "image",
    "date",
    "slug",
  ]);

  const nonConfigPages = pages.filter(
    (page: Page) => !configPages.has(page.slug),
  );

  return nonConfigPages.map((page: Page) => {
    return {
      params: { pages: page.slug },
      props: {
        title: page.title.rendered,
        content: page.content.rendered,
        date: page.date,
        image: page.image,
      },
    };
  });
}

const page = Astro.props;
---

<PageLayout post={page} pageTitle={page.title.rendered} />
